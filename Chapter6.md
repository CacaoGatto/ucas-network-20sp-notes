# 第六章 网络应用

[toc]

## 概述

- 部分看作网络协议（应用层协议），部分看作应用程序
- 应用层协议：定义某类网络应用的进程间通信规则：语法、语义、同步

## 基本应用模型

- 互联网由边缘和核心组成，网络边缘包括用户侧和服务侧，分别由终端和服务器组成、发送和响应数据
- CC模型和CS模型都需要服务系统的支撑

## 用户-用户模型(CC)

- 端服务系统模型
  - 在靠进用户的网络边缘部署**端服务系统**，端服务系统自核实现针对某一通信目的的网络应用。如电子邮件、VPN、隧道通信
  - 对服务系统的服务能力要求不高，可以使单位满足个性化需求和隐私保护并自主控制部署策略及成本，让用户容易实现配置管理
- 中心服务系统模型
  - 用户依赖于统一部署的服务系统实现应用，用户所在网络无法部署管理服务系统，如电商和即时通信
  - 服务系统面向全体用户、对处理能力要求高，分布式部署提高系统服务能力也提升系统复杂度，统一管理用户策略和数据存在隐私风险

## 用户-服务器模型(CS)

- 用户访问服务系统获取数据而无需交互，如Web、DNS、DHCP、SNMP等
- 一般在用户侧部署本地代理，降低工作负载、用户侧配置复杂度、部署成本，提高访问效率
- 分布式部署属于服务器扩容，本地代理不影响性能

## 域名系统DNS

- 用户倾向于使用可读的变长名字，而计算机更易处理定长的数字地址。DNS实现映射，为**几乎所有**网络应用提供**基础服务**（主机名 → IP地址）
- 实现用户空间与网络空间的联通
- 支持域名到地址的映射查询
  - 基于UDP
  - 以CS方式工作
  - 层次化的命名空间
  - 分布式、层次化域名空间存储管理：根服务器、顶级域名服务器、权威服务器
- 域名：逻辑概念，不代表地址。域可逐级划分子域
- 顶级域名：国家或通用顶级域名

### DNS服务器

- 管辖的范围为“区”。区内所有节点可联通，每个区有一个权威域名服务器，范围更小
- 层次化树状结构：根域名服务器、顶级域名服务器、本地域名服务器
- 根域名服务器：知道所有顶级域名服务器的域名和IP地址；本地域名服务器解析失败时直接求助根域名服务器
  - 13个根域名服务器和若干镜像服务器
- 顶级域名服务器：专业机构维护（包括一般性域名和国家地区域名）
- 权威域名服务器：负责一个区，通常由组织提供
- 本地（默认）域名服务器：主机DNS服务的第一跳，没有缓存，进行从上到下的**迭代查询**，为主机提供**递归查询**
- 可靠性：只有主域名服务器可更改数据，并定期把数据复制到辅助域名服务器保存。主域名服务器故障时辅助域名服务器查询。
- 递归查询：主机向本地域名服务器。服务器无缓存时以DNS客户身份向根域名服务器发出查询
- 迭代查询：本地域名服务器向根域名服务器。根域名服务器告知IP地址或下一步要查询的域名服务器
- 每个域名服务器维护一个高速缓存，从而减轻根域名服务器负荷；权限域名服务器的回复包含有效时间，增加超时可减少开销，减少可提高准确性

## 万维网

- 由许多互相链接的**超文本**组成的大规模、联机式的资源系统
- **链接**：沟通两个站点的方法，以主动获取信息
- 分布式超媒体系统，超文本系统的扩充
- 超文本：多个信息（文档）源链接成的
- 超媒体：包括图像等的超文本
- CS方式工作、客户程序为浏览器，服务器程序为万维网服务器

### 统一资源定位符URL

- 唯一标识Web上文档的位置和访问方法，相当于文件路径的网络扩展
- <协议>://<主机>:<端口>/<路径>
- 不区分大小写

### 超文本传送协议HTTP

- 交互客户与服务器
- **面向事务**的应用层协议（信息交换不完整时视为不成功）
- HTTP1.0连接是无状态的，1.1使用持续连接减小响应时间
- 请求一个万维网文档所需的时间：2 * RTT + 文档传输时间（文件大小 / 带宽）
- 非流水线方式：停等算法，等待响应发出请求，比非持续连接节省一个RTT
- 流水线方式：滑动窗口算法，只花费一个RTT时间访问所有对象
- 包括请求报文和响应报文
- 请求报文方法
- 响应报文的状态码方法
- HTTP Cookie：跟踪服务器与用户间传递的状态信息。保存在浏览器，在HTTP头部进行传输

#### 代理服务器（Web缓存）

- 把最近请求和响应暂存在本地磁盘，对相同请求发送暂存的响应，而非根据URL重新访问资源
- 减少网络流量，提升传输性能（Zipf分布）
- 问题：缓存准确性（时效）、隐私问题

### 超文本标记语言HTML

- 制作Web页面的标准语言，实现页面显示标准化
- HTML文档是可用任何文本编辑器创建的ASCII码文件
- 浏览器根据读出的标签及显示器参数重新排版并恢复出读取页面
- 规定了连接的起点（链接引出点）和终点（远程链接（需要指明URL）/本地连接（需要指明本机路径））

### 搜索引擎

- 在互联网进行信息搜索
- 全文检索搜索引擎
  - 根据一定规则建立数据库链接，用户查询时在索引数据库进行查询
  - 问题：有效性/URL排名
- 分类目录搜索引擎
  - 人工审核输入分类目录的数据库，供用户查询
  - 垂直搜索，如分类查询、行业查询

## 电子邮件

- 把邮件发送到收件人使用的邮件服务器的收件人邮箱中
- CC模型，端服务器模式
- 邮件服务器：发送和接收邮件，同时向发送方报告邮件传送情况。需要同时具备发送和接收功能
- 邮箱服务器包括邮件（SMTP）缓存和多个用户邮箱
- 用户代理：用户与电子邮件系统的接口，用于撰写、显示、处理、通信
- 使用基于TCP的SMTP协议发送（推送）邮件，基于TCP的POP3或IMAP协议读取（拉取）邮件
- 邮箱所在主机域名同样依赖DNS协议
- 发送邮件的协议：简单邮件传送协议SMTP
  - 两个相互通信的SMTP进程之间
  - CS方式
- 读取邮件的协议：邮局协议版本3POP3/互联网报文存取协议IMAP
  - 邮局协议POP：CS模式，简单但功能有限
  - 互联网报文存取协议IMAP：联机协议，直接操作服务器上的邮件，且允许只读取邮件的一部分
- MIME协议扩充了电子邮件的内容范围

## 文件传送协议FTP

- 基于TCP
- 提供交互式访问，允许客户指明文件类型格式并有存储权限
- 减少跨平台不兼容性
- 从属进程处理客户请求（控制进程和数据传送进程）

### 简单文件传送协议TFTP

- 基于UDP
- 有自己的差错改正策略以实现可靠传输
- 无庞大命令集和目录功能，无法身份识别
- 文件块长度限制：512
- 可靠传输类似于TCP

## 远程终端协议Telnet

- 终端仿真器
- 将用户与远程主机的击键和输出通过TCP连接返回
- 主进程和从属进程处理
- 通过NVT格式互传达到直连效果

## 动态主机配置协议DHCP

- 主机接入网络时需要必要网络配置，如IP地址（动态、反映节点位置）、子网掩码、默认路由器IP地址、域名服务器IP地址。（允许手工配置）
- DHCP提供即插即用连网的配置机制
- 主机启动时广播发送DHCP发现报文；DHCP查找配置信息或新申请后回复
- DHCP中继代理
  - 不是每个网络都有DHCP服务器，但都有中继代理（成本更低、离主机更近），配置了DHCP服务器的IP地址信息
  - 代理收到**发现报文**后单播传给DHCP服务器，等待**提供报文**后回传给主机（之后还有请求、确认、请求（更新）、确认或停止或无视、释放）
- 租用期：DHCP分配给客户的IP地址等信息的有效期。希望主动释放和更新

## 简单网络管理协议SNMP

- 每个接口都可以是一个被管对象
- 网关协议是代理对象和管理对象之间通信的规则
- CS模型，一对多交互
- 可以监视网络性能、检测分析网络差错、配置网络设备等
- 网络正常工作时可实现统计、配置、测试等功能；出故障时能实现基本的差错检测和恢复
- SNMP本身（管理站和代理之间交换的分组，包括代理中的变量和值）、管理信息结构SMI（定义命名和定义和编码规则）、管理信息库MIB（为被管理实体创建命名对象、规定类型）
- SMI规定所有被管对象必须在命名树上
- MIB是SMI实例的集合，管理程序在其中实现网络管理
- 管理功能：读、写操作，通过探询操作实现（周期性探询，简单但不灵活、开销大）
- 陷阱：不经探询自发发送给管程的信息，用于报告超过门限值的严重事件
- 基于UDP，减小开销但不保证可靠交付
- 客户端和服务器都要使用熟知端口（存在陷阱这一被动方式）

## 应用进程跨越网络的通信

- 系统调用实现应用程序和操作系统间控制权转移
- 应用编程接口(API)沟通操作系统和应用程序。如套接字接口、TLI、Windows Socket
- connect、bind、listen（UDP无）、accept、receive&send、close
