# 第三章 交换网络

> 在数据链路层扩展网络

[toc]

## 特性和设计目标

- 分割网络，允许互联
- 数据只朝目的节点方向传送（转发）
- 引入交换节点
- 结点间分布式自行学习转发规则

## 网桥

- 数据链路层的局域网扩展
- 工作方式
  - 过滤：根据目的地址决定转发或丢弃（目的节点处于本网段时）
  - 转发
  - 基于转发表/转发数据库
- 使各网段成为隔离开的碰撞域，消除碰撞
- 连接异质网络（物理层不同、速率不同）
- 增加带宽（网桥端口数*单个网段带宽）

### 数据帧转发

- 通过转发表/转发数据库存储目的MAC地址到端口的映射关系
- 转发时查找端口号，丢弃与接收端口一致的帧，单播转发不同于接收端口的帧，广播转发无对应条目的帧
- 处理后查询源地址，进行学习（加入并设置定时器）或更新

## 结点位置自学习（转发表生成）

- 收到新数据帧时，记录源MAC地址和输入端口，并将映射关系写入FDB表

## 生成树协议

- 背景：网络中存在冗余链路
  - 可以提升网络健壮性
  - 可能形成环路
- 解决：为每对源目结点分配唯一确定的一条路径
  - 路径是覆盖所有顶点的无环子图

### 生成树算法

- 选择一个网桥作为生成树的根
- 根网桥总在所有端口上转发分组
- 其他结点确定根端口，并计算到根的最短路径
- 每个局域网（通过分布式算法）选取“**指派网桥**”，作为唯一向根网桥转发帧的网桥
- 网桥之间交换配置消息
  - 当前时刻认定的根网桥标识符
  - 从本网桥到根网桥的距离（跳数）
  - 正在发送信号的网桥标识符
- 收到配置消息时，若收到的消息优于已知消息，则保留并更新跳数信息并转发；否则丢弃
  - 优于：根的标识符更小->跳数更小->发送者标识符更小
- 按以上算法执行，可以选择出根或指派网桥（距离根相等是选序号小的）
- 系统稳定后，只有根网桥发送配置信息，其他网桥转发
- 网桥端口状态
  - Forwarding
  - Blocking 某网桥故障时，下游网桥一段时间无法接受配置消息后重新宣布自身为根，并选出新的根结点
  - Disable 软件上关闭

### 网桥的局限性

- 规模不能过大
  - 生成树算法线性扩展，无分层结构
  - 转发所有广播帧可能造成广播风暴
- 动态管理网络

## 二层交换机

- 多接口网桥（以太网交换机），工作在链路层
- 各接口与主机直接相连，全双工方式工作，主机独占带宽
  - 每个链路只有两个结点，无需CSMA/CD
- 同时连通多对接口无碰撞传输数据
- 专用芯片，交换速率高
- 以太网交换机下是一个广播域（集线器下是碰撞域）

## 虚拟局域网（VLAN）

- 由一些局域网的网段构成的与物理位置无关的逻辑组
- 每个帧都有标识符，标明所属逻辑组（插入VLAN标记）
